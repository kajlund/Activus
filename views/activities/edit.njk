{% extends "layouts/layout.njk" %}
{% import "macros/ui.njk" as ui %}

{% block head %}
  <link rel="stylesheet" href="/css/forms.css" />
  <link rel="stylesheet" href="/css/activityedit.css" />
{% endblock %}

{% block main %}
<div class="container container-narrow main-content">

  <header class="view-header">
    <div class="header-title-area">
      {{ ui.icon('ico-edit', class='icon-lg') }}
      <h1 class="text-md">Edit Activity</h1>
    </div>

    <a href="/activities/{{ activity.id }}"
      class="btn-link back-navigation"
    ><span>Back to Details</span>
      {{ ui.icon('ico-chevron-right') }}
    </a>
  </header>

  <form
    method="POST"
    class="detail-card"
    action="/activities/{{ activity.id }}/update"
  >
    <div class="form-body">
      {# Activity Title #}
      {{ ui.field(
        label="Activity Title",
        id="title",
        name="title",
        value=activity.title,
        placeholder="e.g., Morning Trail Run",
        error=errors.title
      ) }}
      {# Date and Kind Selection Grid #}
      <div class="form-grid">
        {{ ui.field(
          label="Date",
          id="when",
          name="when",
          value=activity.when | dateIso,
          type="date",
          error=errors.when
        ) }}
        {# Activity Kind #}
        <div class="form-group">
          <label for="kindId" class="form-label">Activity Kind</label>
          <select id="kindId" name="kindId" class="form-input {% if errors.kindId %}is-invalid{% endif %}">
            <option value="">Select a type...</option>
            {% for kind in activityKinds %}
              <option value="{{ kind.id }}" {% if kind.id == activity.kindId %}selected{% endif %}>
                {{ kind.name }}
              </option>
            {% endfor %}
          </select>
          {% if errors.kindId %}
            <span class="field-error-msg">{{ errors.kindId }}</span>
          {% endif %}
        </div>
      </div>

      {# Numeric Stats Grid #}
      <div class="form-grid">
        {{ ui.field("Distance (km)", "distance", "distance", activity.distance, type="number", error=errors.distance) }}

        {# Multi-input Duration Macro #}
        {{ ui.durationField("Duration", hrs, mins, secs, error=errors.duration) }}
      </div>

      <div class="form-grid">
        {{ ui.field("Elevation (meters)", "elevation", "elevation", activity.elevation, type="number", error=errors.elevation) }}

        {{ ui.field("Calories", "calories", "calories", activity.calories, type="number", error=errors.calories) }}
      </div>

      {# Description / Memo #}
      {{ ui.field(
        label="Notes & Description",
        id="description",
        name="description",
        value=activity.description,
        memo=true,
        placeholder="Describe your session...",
        error=errors.description
      ) }}
    </div>

    {# Commands Footer #}
    <footer class="card-footer">
      <button type="submit"
        class="btn btn-primary btn-full"
      >
        {{ ui.icon('ico-edit') }}
        <span>Save Changes</span>
      </button>
      <a href="/activities/{{ activity.id }}"
        class="btn btn-outline btn-full"
      >Discard</a>
    </footer>
  </form>
</div>
{% endblock %}
